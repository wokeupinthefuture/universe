<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stream To-Do List</title>
  <style>
    body {
      margin: 0; padding: 0;
      background: transparent;
      height: 100vh;
      width: 100vw;
      display: flex;
      justify-content: flex-end;
      align-items: flex-start;
      font-family: "Consolas", "Cascadia Mono", "Menlo", "DejaVu Sans Mono", monospace; /* ImGui-like monospace */
    }
    .imgui-window {
      background: rgba(37,37,38,0.98); /* WindowBg */
      border: 1px solid #5a5d63; /* thin outer frame */
      border-radius: 0; /* perfectly squared */
      width: 300px;
      height: 215px;
      box-shadow: none;
    }
    .imgui-title {
      background: #2f6db6; /* TitleBgActive (screenshot-like) */
      color: #ffffff;
      font-weight: 700;
      font-size: 13px;
      line-height: 20px;
      padding: 2px 6px;
      border-bottom: 1px solid #3a6ca3; /* thin edge */
      border-top-left-radius: 0; /* squared */
      border-top-right-radius: 0; /* squared */
      user-select: none;
    }
    .imgui-body { padding: 6px; }
    .container {
      background: transparent; /* move window bg to .imgui-window */
      border: none;
      border-radius: 0;
      padding: 0; /* list area controls spacing */
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      color: #ffffffff; /* ImGui Text */
    }
    .section-title {
      color: #c7c7c7; /* Header */
      font-weight: 700;
      font-size: 0.9em;
      line-height: 1.2em;
      margin: 6px 0 4px 2px; /* subtle top margin */
      letter-spacing: 0.02em;
      text-shadow: none;
    }
    .section-title:first-child {
      margin-top: 2px;
    }
    ul {
      margin: 0 0 0 0.7em;
      padding: 0;
      list-style: none;
    }
    li { margin: 0 0 2px 0; padding: 0; }
    .finished {
      color: #808080; /* TextDisabled */
      text-decoration: line-through;
      font-size: 1em;
      line-height: 1.45em;
      text-shadow: none;
    }
    .current {
      color: #ffffff; /* Text */
      font-weight: 700;
      font-size: 1em;
      line-height: 1.45em;
      text-shadow: none;
    }
    .todo {
      color: #e6e6e6;
      font-size: 1em;
      line-height: 1.45em;
      text-shadow: none;
    }
    .main-list {
      margin: 6px 0 0 0; /* tighter */
      padding: 0; /* list reset */
      list-style: none;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: stretch;
      width: 100%;
      gap: 0; /* ImGui rows are tight, separators/striping used instead */
      background: #0f0f10; /* dark panel inside window */
      border: 1px solid #2e3035; /* ImGui child border */
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
    }
    .main-list li {
      display: flex;
      align-items: center;
      justify-content: flex-start; /* LTR */
      padding: 3px 6px; /* compact item rows */
      font-size: 13px; /* ImGui-like density */
      border-radius: 0;
      transition: background 0.12s ease, color 0.12s ease;
      text-align: left;
      margin: 0;
      background: transparent;
      border: none;
      box-shadow: none;
      min-height: 18px; /* ensure row height */
    }
    .main-list li:nth-child(odd)  { background: rgba(255,255,255,0.02); } /* striped rows: odd */
    .main-list li:nth-child(even) { background: rgba(255,255,255,0.05); } /* striped rows: even */
    .main-list li:hover { background: rgba(66, 150, 250, 0.13); } /* HeaderHovered */
    .completed-item {
      color: #808080; /* TextDisabled */
      text-decoration: line-through;
      opacity: 1;
      background: transparent; /* keep stripes where applicable */
    }
    .current-item {
      color: #ffffff;
      background: rgba(66, 150, 250, 0.35); /* ImGui HeaderActive */
      font-weight: 700;
      font-size: 1.02em;
      border-left: none;
      border-right: none;
    }
    .todo-item {
      color: #e6e6e6;
      opacity: 1;
      font-weight: 500;
      background: transparent;
    }
    .placeholder-item {
      opacity: 0.18;
      pointer-events: none;
      background: transparent;
    }

    /* remove accent dot */
  </style>
</head>
<body>
  <div class="imgui-window">
    <div class="imgui-title">todo</div>
    <div class="imgui-body">
      <div class="container" id="todo-container">Loading...</div>
    </div>
  </div>
  <script>
    /*
    New JSON structure:
    {
      completed: [ ... ],
      current: "...",
      todo: [ ... ]
    }
    */
    const VISIBLE_ITEMS = 7; // fixed list size
    async function fetchAndRenderTodo() {
      const container = document.getElementById('todo-container');
      try {
        const res = await fetch('todo.json?' + new Date().getTime());
        const data = await res.json();
        const completed = Array.isArray(data.completed) ? data.completed : [];
        const current = data.current || '';
        const todo = Array.isArray(data.todo) ? data.todo : [];

        let center = Math.floor(VISIBLE_ITEMS / 2);
        let before = completed.slice(-center);
        if (before.length < center) {
          before = Array(center - before.length).fill('').concat(before);
        }
        let after = todo.slice(0, VISIBLE_ITEMS - before.length - 1);
        if (after.length < VISIBLE_ITEMS - before.length - 1) {
          after = after.concat(Array(VISIBLE_ITEMS - before.length - 1 - after.length).fill(''));
        }
        const items = before.concat([current], after);

        let html = '<ul class="main-list">';
        for (let i = 0; i < items.length; ++i) {
          let cls = '';
          if (i < center && items[i]) cls = 'completed-item';
          else if (i == center) cls = 'current-item';
          else if (items[i]) cls = 'todo-item';
          else cls = 'placeholder-item';
          html += `<li class="${cls}">${items[i] || '&nbsp;'}</li>`;
        }
        html += '</ul>';
        container.innerHTML = html;
      } catch (e) {
        container.innerHTML = '<span style="color:#e86969">Failed to load todo list.</span>';
      }
    }
    fetchAndRenderTodo();
    setInterval(fetchAndRenderTodo, 3000);
  </script>
</body>
</html>

